
import { expect, test } from 'vitest'
import { calculateStatus } from '../../utils/calculateStatus'
import { NTPData, RIPEData } from '../../utils/types'

test('Passing Data', () => {
    const ntpData: NTPData = {
        ntp_version: 4,
        vantage_point_ip: "145.94.203.168",
        ip: "17.253.52.253",
        server_name: "time.apple.com",
        is_anycast: false,
        country_code: "NL",
        coordinates: [52.3824, 4.8995],
        ntp_server_ref_parent_ip: null,
        ref_id: "GPSs",
        client_sent_time: [3959231207, 3938824192],
        server_recv_time: [3959231202, 60612608],
        server_sent_time: [3959231202, 60737536],
        client_recv_time: [3959231207, 3962165248],
        offset: -59.669,
        RTT: 5.405,
        stratum: 1,
        precision: -20,
        root_delay: 0,
        poll: 6,
        root_dispersion: 0.0001678466796875,
        ntp_last_sync_time: [3959231196, 2094338048],
        leap: 0,
        jitter: 0.8551980300704615,
        nr_measurements_jitter: 8,
        asn_ntp_server: "6185",
        time: 1750242407000
    }
    const ripeData: RIPEData = {
        measurementData: {
            ntp_version: 4,
            vantage_point_ip: "88.202.166.71",
            ip: "17.253.52.125",
            server_name: "time.apple.com",
            is_anycast: false,
            country_code: "NL",
            coordinates: [52.3824, 4.8995],
            ntp_server_ref_parent_ip: "",
            ref_id: "GPSs",
            client_sent_time: [3959232158, 4123875328],
            server_recv_time: [3959232158, 3914455040],
            server_sent_time: [3959232158, 3914508288],
            client_recv_time: [3959232158, 4132907008],
            offset: 49.805,
            RTT: 2.09,
            stratum: 1,
            precision: 9.53674e-7,
            root_delay: 0,
            poll: 64,
            root_dispersion: 0.00018310477025806904,
            asn_ntp_server: "6185",
            ntp_last_sync_time: [-1, -1],
            leap: -1,
            jitter: -1,
            nr_measurements_jitter: -1,
            time: 1750243358000
        },
        probe_addr_v4: "88.202.166.71",
        probe_addr_v6: "2a04:8400:c300:ba00:ea94:f6ff:fe48:5f64",
        probe_id: "22138",
        probe_country: "NL",
        probe_location: [52.0015, 4.3685],
        time_to_result: 30.280227,
        got_results: true,
        measurement_id: 110405699
    }
    expect(calculateStatus(ntpData,ripeData)).toBe("PASSING")
})
test('Caution Data - NTP higher', () => {
    const ntpData: NTPData = {
        ntp_version: 4,
        vantage_point_ip: "145.94.203.168",
        ip: "17.253.52.253",
        server_name: "time.apple.com",
        is_anycast: false,
        country_code: "NL",
        coordinates: [52.3824, 4.8995],
        ntp_server_ref_parent_ip: null,
        ref_id: "GPSs",
        client_sent_time: [3959231207, 3938824192],
        server_recv_time: [3959231202, 60612608],
        server_sent_time: [3959231202, 60737536],
        client_recv_time: [3959231207, 3962165248],
        offset: -590.669,
        RTT: 5.405,
        stratum: 1,
        precision: -20,
        root_delay: 0,
        poll: 6,
        root_dispersion: 0.0001678466796875,
        ntp_last_sync_time: [3959231196, 2094338048],
        leap: 0,
        jitter: 0.8551980300704615,
        nr_measurements_jitter: 8,
        asn_ntp_server: "6185",
        time: 1750242407000
    }
    const ripeData: RIPEData = {
        measurementData: {
            ntp_version: 4,
            vantage_point_ip: "88.202.166.71",
            ip: "17.253.52.125",
            server_name: "time.apple.com",
            is_anycast: false,
            country_code: "NL",
            coordinates: [52.3824, 4.8995],
            ntp_server_ref_parent_ip: "",
            ref_id: "GPSs",
            client_sent_time: [3959232158, 4123875328],
            server_recv_time: [3959232158, 3914455040],
            server_sent_time: [3959232158, 3914508288],
            client_recv_time: [3959232158, 4132907008],
            offset: 49.805,
            RTT: 2.09,
            stratum: 1,
            precision: 9.53674e-7,
            root_delay: 0,
            poll: 64,
            root_dispersion: 0.00018310477025806904,
            asn_ntp_server: "6185",
            ntp_last_sync_time: [-1, -1],
            leap: -1,
            jitter: -1,
            nr_measurements_jitter: -1,
            time: 1750243358000
        },
        probe_addr_v4: "88.202.166.71",
        probe_addr_v6: "2a04:8400:c300:ba00:ea94:f6ff:fe48:5f64",
        probe_id: "22138",
        probe_country: "NL",
        probe_location: [52.0015, 4.3685],
        time_to_result: 30.280227,
        got_results: true,
        measurement_id: 110405699
    }
    expect(calculateStatus(ntpData,ripeData)).toBe("CAUTION")
})
test('Caution Data - RIPE higher', () => {
    const ntpData: NTPData = {
        ntp_version: 4,
        vantage_point_ip: "145.94.203.168",
        ip: "17.253.52.253",
        server_name: "time.apple.com",
        is_anycast: false,
        country_code: "NL",
        coordinates: [52.3824, 4.8995],
        ntp_server_ref_parent_ip: null,
        ref_id: "GPSs",
        client_sent_time: [3959231207, 3938824192],
        server_recv_time: [3959231202, 60612608],
        server_sent_time: [3959231202, 60737536],
        client_recv_time: [3959231207, 3962165248],
        offset: -59.669,
        RTT: 5.405,
        stratum: 1,
        precision: -20,
        root_delay: 0,
        poll: 6,
        root_dispersion: 0.0001678466796875,
        ntp_last_sync_time: [3959231196, 2094338048],
        leap: 0,
        jitter: 0.8551980300704615,
        nr_measurements_jitter: 8,
        asn_ntp_server: "6185",
        time: 1750242407000
    }
    const ripeData: RIPEData = {
        measurementData: {
            ntp_version: 4,
            vantage_point_ip: "88.202.166.71",
            ip: "17.253.52.125",
            server_name: "time.apple.com",
            is_anycast: false,
            country_code: "NL",
            coordinates: [52.3824, 4.8995],
            ntp_server_ref_parent_ip: "",
            ref_id: "GPSs",
            client_sent_time: [3959232158, 4123875328],
            server_recv_time: [3959232158, 3914455040],
            server_sent_time: [3959232158, 3914508288],
            client_recv_time: [3959232158, 4132907008],
            offset: 490.805,
            RTT: 2.09,
            stratum: 1,
            precision: 9.53674e-7,
            root_delay: 0,
            poll: 64,
            root_dispersion: 0.00018310477025806904,
            asn_ntp_server: "6185",
            ntp_last_sync_time: [-1, -1],
            leap: -1,
            jitter: -1,
            nr_measurements_jitter: -1,
            time: 1750243358000
        },
        probe_addr_v4: "88.202.166.71",
        probe_addr_v6: "2a04:8400:c300:ba00:ea94:f6ff:fe48:5f64",
        probe_id: "22138",
        probe_country: "NL",
        probe_location: [52.0015, 4.3685],
        time_to_result: 30.280227,
        got_results: true,
        measurement_id: 110405699
    }
    expect(calculateStatus(ntpData,ripeData)).toBe("CAUTION")
})
test('Failing Data', () => {
    const ntpData: NTPData = {
        ntp_version: 4,
        vantage_point_ip: "145.94.203.168",
        ip: "17.253.52.253",
        server_name: "time.apple.com",
        is_anycast: false,
        country_code: "NL",
        coordinates: [52.3824, 4.8995],
        ntp_server_ref_parent_ip: null,
        ref_id: "GPSs",
        client_sent_time: [3959231207, 3938824192],
        server_recv_time: [3959231202, 60612608],
        server_sent_time: [3959231202, 60737536],
        client_recv_time: [3959231207, 3962165248],
        offset: -590.669,
        RTT: 5.405,
        stratum: 1,
        precision: -20,
        root_delay: 0,
        poll: 6,
        root_dispersion: 0.0001678466796875,
        ntp_last_sync_time: [3959231196, 2094338048],
        leap: 0,
        jitter: 0.8551980300704615,
        nr_measurements_jitter: 8,
        asn_ntp_server: "6185",
        time: 1750242407000
    }
    const ripeData: RIPEData = {
        measurementData: {
            ntp_version: 4,
            vantage_point_ip: "88.202.166.71",
            ip: "17.253.52.125",
            server_name: "time.apple.com",
            is_anycast: false,
            country_code: "NL",
            coordinates: [52.3824, 4.8995],
            ntp_server_ref_parent_ip: "",
            ref_id: "GPSs",
            client_sent_time: [3959232158, 4123875328],
            server_recv_time: [3959232158, 3914455040],
            server_sent_time: [3959232158, 3914508288],
            client_recv_time: [3959232158, 4132907008],
            offset: 490.805,
            RTT: 2.09,
            stratum: 1,
            precision: 9.53674e-7,
            root_delay: 0,
            poll: 64,
            root_dispersion: 0.00018310477025806904,
            asn_ntp_server: "6185",
            ntp_last_sync_time: [-1, -1],
            leap: -1,
            jitter: -1,
            nr_measurements_jitter: -1,
            time: 1750243358000
        },
        probe_addr_v4: "88.202.166.71",
        probe_addr_v6: "2a04:8400:c300:ba00:ea94:f6ff:fe48:5f64",
        probe_id: "22138",
        probe_country: "NL",
        probe_location: [52.0015, 4.3685],
        time_to_result: 30.280227,
        got_results: true,
        measurement_id: 110405699
    }
    expect(calculateStatus(ntpData,ripeData)).toBe("FAILING")
})